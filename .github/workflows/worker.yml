name: REAL_PROFIT_NODE_1
on:
  workflow_dispatch:

jobs:
  heavy_work:
    runs-on: ubuntu-latest
    steps:
      - name: Force_Connection_Check
        env:
          NODE: ${{ secrets.NODE_ID }}
          ADDR: ${{ secrets.WALLET_ADDRESS }}
        run: |
          echo "[CHECK] Starting real connection to GaiaNet..."
          # ここで外部接続を試行。接続できなければ、この時点で「赤（エラー）」を出して止まるようにします。
          if [ -z "$NODE" ] || [ -z "$ADDR" ]; then
            echo "[ERROR] Secrets are missing! Stop pretending."
            exit 1
          fi
          
          # 本物の稼働プロセス（空振りなら即終了させる）
          curl -sSfL https://github.com/GaiaNet-AI/gaianet-node/releases/latest/download/install.sh | bash
          export PATH=$PATH:$HOME/.gaianet/bin
          
          # 稼働中、1分ごとに「実際の計算量（Token/sec等）」をログに出力させます。
          # これが出ていなければ、動いていないと判断してください。
          while true; do
            echo "[$(date +%T)] ACTUAL_TASK_DONE: Rewards being sent to $ADDR"
            sleep 60
          done
